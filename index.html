<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
		<script type='text/javascript' src='http://www.google.com/jsapi'></script>
		<script type="text/javascript">
			var EarthQuake = function(text){

				this.strength = parseFloat(text.match(/Ml:[0-9]\.[0-9]/)[0].replace("Ml:",""));
				this.dateTime = new Date(text.match(/[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{1,2}:[0-9]{2}:[0-9]{2}/)[0]);
				this.locationText = text.match(/Prov=[a-zA-Z, ]*/)[0].replace("Prov=", "");

				this.originalText = text;
			};

			EarthQuake.prototype.getStrength = function(){
				return parseFloat(this.strength);
			};

			EarthQuake.prototype.getOccurrence = function(){
				return this.dateTime;
			};

			EarthQuake.prototype.getLocationText = function(){
				return this.locationText;
			};

			EarthQuake.prototype.toString = function(){
				return "Strength " + this.getStrength() + " at " + this.locationText;
			};
		</script>

		<script type="text/javascript">
			google.load('visualization', '1', {'packages':['annotatedtimeline']});

			var print = function (msg){
				$("#output").append("<div>" + msg + "</div>");
			};

			$(function(){
				var amountToFetch = 200;
				$.getJSON("http://twitter.com/statuses/user_timeline/INGVterremoti.json?callback=?&count=" + amountToFetch,
					function(data){
						var earthQuakeData = [];
						var tmp = null;
						for(var i=0; i < data.length; i++){
							tmp = new EarthQuake(data[i].text);
							earthQuakeData.push(tmp);

							//print(tmp.toString());
						}

						drawEarthQuakeTimeline(earthQuakeData);
					});
			});

			var drawEarthQuakeTimeline = function(quakeData){
				var data = new google.visualization.DataTable();
		    	data.addColumn('datetime', 'Date');
		     	data.addColumn('number', 'Strength');
		     	data.addColumn('string', 'title1');
  				data.addColumn('string', 'text1');
		        //data.addColumn({type:'string', role:'annotation'}); // annotation role col.
				//data.addColumn({type:'string', role:'annotationText'});

		        var d = [];
		        for(var i=0; i<quakeData.length; i++){
		        	d.push([quakeData[i].getOccurrence(), quakeData[i].getStrength(), quakeData[i].getStrength().toString(), quakeData[i].getLocationText()]);
		        }

		        data.addRows(d);
		        var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('timeline'));
		        chart.draw(data, {displayAnnotations: true});

		        google.visualization.events.addListener(chart, 'select', function(e){
		        	console.log("Selected", e);
		        });
			}
		</script>
	</head>
	<body>
		<h1>Terremoti</h1>
		<div id="output"></div>
		<div id="timeline" style="width:1200px; height:440px;"/>

		<a href="https://twitter.com/#!/INGVterremoti">https://twitter.com/#!/INGVterremoti</a>
	</body>
</html>