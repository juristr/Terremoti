<html>
	<head>
		<title>Terremoti - Italy</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
		<script type='text/javascript' src='http://www.google.com/jsapi'></script>
		<script type="text/javascript">
			var EarthQuake = function(text){

				this.strength = parseFloat(text.match(/Ml:[0-9]\.[0-9]/)[0].replace("Ml:",""));
				this.dateTime = new Date(text.match(/[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{1,2}:[0-9]{2}:[0-9]{2}/)[0]);
				this.locationText = text.match(/Prov=[a-zA-Z, ]*/)[0].replace("Prov=", "");

				this.originalText = text;
			};

			EarthQuake.prototype.getStrength = function(){
				return parseFloat(this.strength);
			};

			EarthQuake.prototype.getOccurrence = function(){
				return this.dateTime;
			};

			EarthQuake.prototype.getLocationText = function(){
				return this.locationText;
			};

			EarthQuake.prototype.toString = function(){
				return "Strength " + this.getStrength() + " at " + this.locationText;
			};
		</script>

		<script type="text/javascript">
			google.load('visualization', '1', {'packages':['annotatedtimeline']});

			var print = function (msg){
				$("#output").append("<div>" + msg + "</div>");
			};

			$(document).ajaxError(function(ev, req, settings){
				alert("error");
			});

			$(function(){
				var amountToFetch = 30;
				$.ajax({
					url: "http://twitter.com/statuses/user_timeline/INGVterremoti.json?count=" + amountToFetch + "&callback=?",
					type: "GET",
					dataType: "json",
					success:function(data){
						var earthQuakeData = [];
						var tmp = null;
						for(var i=0; i < data.length; i++){
							tmp = new EarthQuake(data[i].text);
							earthQuakeData.push(tmp);

							//print(tmp.toString());
						}

						drawEarthQuakeTimeline(earthQuakeData);
					},
					error: function(e){
						console.log(e);
					}
				});
				/*
				$.getJSON("http://twitter.com/statuses/user_timeline/INGVterremoti.json?count=" + amountToFetch + "&callback=?",
					function(data){
						var earthQuakeData = [];
						var tmp = null;
						for(var i=0; i < data.length; i++){
							tmp = new EarthQuake(data[i].text);
							earthQuakeData.push(tmp);

							//print(tmp.toString());
						}

						drawEarthQuakeTimeline(earthQuakeData);
					});
				*/
			});

			var drawEarthQuakeTimeline = function(quakeData){
				var data = new google.visualization.DataTable();
		    	data.addColumn('datetime', 'Date');
		     	data.addColumn('number', 'Strength');
		     	data.addColumn('string', 'title1');
  				data.addColumn('string', 'text1');
		        //data.addColumn({type:'string', role:'annotation'}); // annotation role col.
				//data.addColumn({type:'string', role:'annotationText'});

		        var d = [];
		        for(var i=0; i<quakeData.length; i++){
		        	d.push([quakeData[i].getOccurrence(), quakeData[i].getStrength(), quakeData[i].getStrength().toString(), quakeData[i].getLocationText()]);
		        }

		        data.addRows(d);
		        var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('timeline'));
		        chart.draw(data, {displayAnnotations: true});

		        google.visualization.events.addListener(chart, 'select', function(e){
		        	console.log("Selected", e);
		        });
			}
		</script>
	</head>
	<body>
		<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
		<div class="container">
		  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		  </a>
		  <a class="brand" href="#">Visua-Terremoti</a>
		  <div class="nav-collapse">
		    <ul class="nav">
		      <li class="index.html"><a href="#">Home</a></li>
		      <li><a href="#about">Info</a></li>
		      <li><a href="http://twitter.com/juristr">Follow Me on Twitter</a></li>
		    </ul>
		  </div><!--/.nav-collapse -->
		</div>
		</div>
		</div>
		<div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <h1>Visua - Terremoti</h1>
        <p>Graphical visualizations of the lastest earthquakes in Italy.</p>
      </div>

      <!-- Example row of columns -->
      <div class="row">
        <div class="span12">
          <div id="output"></div>
		  <div id="timeline" style="width:1200px; height:440px;"/>
        </div>
       </div>
       <!--
       <div class="row" style="margin-top:15px">
        <div class="span4">
          <h2>Stats</h2>
           <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <p><a class="btn" href="#">View details &raquo;</a></p>
       </div>
        <div class="span4">
          <h2>Heading</h2>
          <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
          <p><a class="btn" href="#">View details &raquo;</a></p>
        </div>
      </div>
		-->
		<div class="span12"/>
      <hr>

      <footer>
        <p style="text-align:center">&copy; <a href="http://twitter.com/juristr">@juristr</a>&nbsp;-&nbsp;Data: <a href="https://twitter.com/#!/INGVterremoti" target="window">@INGVterremoti</a></p>
      </footer>

    </div>
	</body>
</html>